<html>

<head>

<style>
body { margin:0px; padding:0px; overflow: hidden ;}
.frame { position:fixed; left:0px; top:0px; width:100%; height:100%; z-index:99; }
.dot { position:relative; z-index:99; background:#CCC; width:35px; height:35px; border-radius: 100%; cursor: pointer; top:50%; left:50%; transform: translateX(-50%) translateY(-50%);}
.tape { position: fixed; top:25px; right:25px; width:25px; height:25px; z-index:999; border:0px; }
box-icon { position:absolute; left:50%; top:50%; transform: translateX(-50%) translateY(-50%);}
#line { position:absolute; left:50%; width:2px; height:100%; margin-left:-1px; z-index:0; background:purple;}

</style>

</head>

<body>

    <div id="line"></div>

<div class='frame'>

        <div target='farewell' file='farewelltoafriend.mp3' class='draggable dot'><box-icon name="music"></box-icon></div>
        <div target='stream' file='stream.mp3' class='draggable dot'><box-icon name="water"></box-icon></div></div>
        <div target='drums' file='kododrums.mp3' class='draggable dot'><box-icon stype="solid" name="shield"></box-icon></div></div>


    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script src="https://unpkg.com/boxicons@latest/dist/boxicons.js"></script>


<script src="https://pixijs.download/dev/pixi.min.js"></script>
<script src="js/pixi-sound.js"></script>

<script>

$(document).ready(function(){
    GenerateSounds();
});

function GenerateSounds(){
    console.log("generating...");

    $('.dot').each(function(index, item){
        $target = $(this).attr("target");
        $file = $(this).attr("file");
        AddSound($target, $file);
    });

}

function AddSound(sound, file){

    PIXI.sound.add(sound, {
    url: 'audio/'+file,
    preload: true,
    loaded: function() {
        // duration can only be used once the sound is loaded
        console.log('Duration: ', PIXI.sound.duration(sound), 'seconds');
        StartVolume(sound);
        PIXI.sound.play(sound);
    }
});

}



function StartVolume(target){
    var it = PIXI.sound._sounds[target];
    it.volume = 0.5;
}

function ChangeGain(target, gain){
    var it = PIXI.sound._sounds[target];
    //console.log(target);
    it.volume = gain;

}

function ChangePan(target, pan){
    var it = PIXI.sound._sounds[target];
    it.filters = [ new PIXI.sound.filters.StereoFilter(pan) ];
    console.log(it);
    
}


$(".draggable").draggable({ 
          containment: "parent", 
          scroll: false,
          start: function() 
            { 
            var Yposition = $(this).position().top;
			var Xposition = $(this).position().left;

            console.log(Yposition+':'+Xposition);
            },
          drag: function() 
            {
			var Xposition = $(this).position().left - $(window).width() / 2;
			var Xpercent = ($(window).width() / 100).toFixed(0);
			
			var X = (Xposition / Xpercent).toFixed(0);
			var Xpan = (X / 100) * 2;
			console.log(Xpan);

            var me = $(this).attr("target");

			ChangePan(me, Xpan);


			var Yposition = $(window).height() - $(this).position().top;
			var Ypercent = ($(window).height() / 100).toFixed(0);
			
			var Y = (Yposition / Ypercent).toFixed(0);
			var Ypan = (Y / 100)*1;
			console.log(Ypan);
            ChangeGain(me,Ypan);

			

            
            }
         });



</script>

</body>

</html>